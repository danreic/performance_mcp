# Performance MCP Server üöÄ

A powerful Model Context Protocol (MCP) server designed for **Performance QA automation engineers** working with Vast Data features. This server provides comprehensive tools for managing performance testing workflows, including Jenkins integration, Git operations, database queries, and Google Sheets data extraction.

## üéØ Features

- **Jenkins Integration**: Trigger jobs, extract job results, and get unique job identifiers
- **Git Operations**: Compare commits, get commit diffs, and retrieve commit lists
- **Database Queries**: Fetch performance test data from PostgreSQL databases
- **Google Sheets Integration**: Extract and analyze data from Google Sheets
- **Performance Testing**: Specialized tools for Vast Data performance testing workflows

## üìã Prerequisites

- **Python 3.11+** (required)
- **uv** package manager (recommended for fast dependency management)
- Access to Jenkins instance
- PostgreSQL database connection
- Google Sheets API credentials (optional)

## üöÄ Installation

Choose the installation method based on your use case:

### üê≥ For Using (Production/Docker)

For users who want to use the MCP server with Docker:

#### Prerequisites
- **Docker** installed and running
- **Docker Compose** (optional, for easier management)
- **Pre-built Docker image** (`performance-mcp.tar.gz` file or access to container registry)

#### Step 1: Load the Pre-built Docker Image
```bash
# Option A: Load from tar file (if you have the performance-mcp.tar.gz)
docker load -i performance-mcp.tar.gz
```

> **Note**: The `performance-mcp.tar.gz` file is automatically generated by the pre-commit hooks when developers make changes. This file is ignored by git (too large) and should be shared via file sharing services, internal servers, or direct transfer.

#### Step 2: Configure MCP Client
Add this server to your MCP client configuration (e.g., Cursor, Claude Desktop):

```json
{
  "mcpServers": {
    "performance-mcp": {
      "command": "docker",
      "args": [
        "run",
        "-i",
        "--rm",
        "-e", "DB_HOST",
        "-e", "DB_PORT", 
        "-e", "DB_NAME",
        "-e", "DB_USER",
        "-e", "DB_PASSWORD",
        "-e", "JENKINS_URL",
        "-e", "JENKINS_PORT",
        "-e", "JENKINS_USERNAME",
        "-e", "JENKINS_API_TOKEN",
        "-e", "GITLAB_URL",
        "-e", "GITLAB_TOKEN",
        "-v", "/path/to/your/repo:/app/repo",
        "-v", "/path/to/google-auth.json:/app/credentials/service-account.json",
        "performance_mcp:latest"
      ],
      "env": {
        "DB_HOST": "your_postgres_host",
        "DB_PORT": "5432",
        "DB_NAME": "your_database_name",
        "DB_USER": "your_username",
        "DB_PASSWORD": "your_password",
        "JENKINS_URL": "https://your-jenkins-instance.com",
        "JENKINS_PORT": "8080",
        "JENKINS_USERNAME": "your_username",
        "JENKINS_API_TOKEN": "your_api_token",
        "GITLAB_URL": "https://gitlab.com/your-org/your-repo.git",
        "GITLAB_TOKEN": "your_gitlab_token"
      }
    }
  }
}
```

### üõ†Ô∏è For Developing

For developers who want to modify and extend the MCP server:

#### Prerequisites
- **Python 3.11+** (required)
- **uv** package manager (recommended)
- **Docker** (for building production images)

#### Step 1: Install uv (if not already installed)
```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

#### Step 2: Clone and Setup
```bash
git clone <repository-url>
cd performance_mcp

# Install dependencies
uv sync

# Activate virtual environment
source .venv/bin/activate  # On Unix/macOS
# or
.venv\Scripts\activate     # On Windows
```

#### Step 3: Setup Pre-commit Hooks (Optional)
```bash
# Install pre-commit
pip install pre-commit

# Install the hooks
pre-commit install
```

The pre-commit hooks will automatically run on **every commit**:
- Build the Docker image (regardless of which files changed)
- Export the Docker image to `performance-mcp.tar.gz`
- Run code quality checks (trailing whitespace, YAML validation, etc.)

> **Note**: The Docker build runs on every commit to ensure the `performance-mcp.tar.gz` file is always up-to-date and ready for distribution to users.

#### Step 4: Development MCP Configuration
For development, you can run the server directly with Python:

```json
{
  "mcpServers": {
    "performance-mcp-dev": {
      "command": "python",
      "args": ["/path/to/performance_mcp/server.py"],
      "env": {
        "PYTHONPATH": "/path/to/performance_mcp",
        "DB_HOST": "your_postgres_host",
        "DB_PORT": "5432",
        "DB_NAME": "your_database_name",
        "DB_USER": "your_username",
        "DB_PASSWORD": "your_password",
        "JENKINS_URL": "https://your-jenkins-instance.com",
        "JENKINS_PORT": "8080",
        "JENKINS_USERNAME": "your_username",
        "JENKINS_API_TOKEN": "your_api_token",
        "LOCAL_REPO_PATH": "/path/to/local/repo",
        "GITLAB_URL": "https://gitlab.com/your-org/your-repo.git",
        "GITLAB_TOKEN": "your_gitlab_token",
        "GOOGLE_SERVICE_ACCOUNT_JSON": "/path/to/credentials.json"
      }
    }
  }
}
```

## ‚öôÔ∏è Configuration

### Environment Variables

Create a `.env` file in the project root with the following variables:

```bash
# Database Configuration
DB_HOST=your_postgres_host
DB_PORT=5432
DB_NAME=your_database_name
DB_USER=your_username
DB_PASSWORD=your_password

# Jenkins Configuration
JENKINS_URL=https://your-jenkins-instance.com
JENKINS_PORT=8080
JENKINS_USERNAME=your_username
JENKINS_API_TOKEN=your_api_token

# Git/GitLab Configuration
LOCAL_REPO_PATH=/path/to/local/repo
GITLAB_URL=https://gitlab.com/your-org/your-repo.git
GITLAB_TOKEN=your_gitlab_token

# Google Sheets Configuration (Optional)
GOOGLE_SERVICE_ACCOUNT_JSON=/path/to/credentials.json
```

### Google Sheets Setup (Optional)

1. **Enable Google Sheets API**:
   - Go to [Google Cloud Console](https://console.cloud.google.com/)
   - Create a new project or select existing one
   - Enable the Google Sheets API
   - Create credentials (Service Account or OAuth 2.0)

2. **Download credentials**:
   - Save the JSON file to your project directory
   - Update the `GOOGLE_SERVICE_ACCOUNT_JSON` in your `.env` file

## üèÉ‚Äç‚ôÇÔ∏è Running the Server

### Start the MCP Server

```bash
# Using uv
uv run python server.py

# Or activate venv first, then run
source .venv/bin/activate
python server.py
```

The server will start and be ready to accept MCP connections.



## üß™ Development

### Project Structure

```
performance_mcp/
‚îú‚îÄ‚îÄ pysrc/
‚îÇ   ‚îú‚îÄ‚îÄ db_utils.py          # Database utilities
‚îÇ   ‚îú‚îÄ‚îÄ git_tools.py         # Git operations
‚îÇ   ‚îú‚îÄ‚îÄ jenkins.py           # Jenkins integration
‚îÇ   ‚îî‚îÄ‚îÄ sheets_utils.py      # Google Sheets integration
‚îú‚îÄ‚îÄ server.py                # Main MCP server
‚îú‚îÄ‚îÄ Dockerfile               # Docker build configuration
‚îú‚îÄ‚îÄ docker-compose.yml       # Docker Compose configuration
‚îú‚îÄ‚îÄ pyproject.toml           # Project configuration
‚îú‚îÄ‚îÄ requirements.txt         # Dependencies
‚îú‚îÄ‚îÄ env.example              # Environment variables template
‚îú‚îÄ‚îÄ .pre-commit-config.yaml  # Pre-commit hooks configuration
‚îî‚îÄ‚îÄ README.md               # This file
```

### Docker Build Process

The project includes automated Docker builds via pre-commit hooks:

1. **Automatic Build**: On **every commit** (regardless of which files changed), the pre-commit hook automatically:
   - Builds the Docker image with tag `performance_mcp:latest`
   - Exports the image to `performance-mcp.tar.gz` for distribution
   - Ensures the tar file is always up-to-date and ready for users

2. **Manual Build**: You can also build manually:
   ```bash
   # Build the image
   docker build -t performance_mcp:latest .
   
   # Export to tar (optional)
   docker save performance_mcp:latest -o performance-mcp.tar.gz
   ```

3. **Load from Tar**: To load the exported image on another machine:
   ```bash
   docker load -i performance-mcp.tar.gz
   ```

### Adding New Tools

1. **Define the tool function** in `server.py`:
   ```python
   @mcp.tool
   async def your_new_tool(param1: str, ctx: Context) -> str:
       """Your tool description"""
       # Implementation here
       pass
   ```

2. **Access resources** through the context:
   ```python
   db_instance = ctx.request_context.lifespan_context.db
   jenkins_instance = ctx.request_context.lifespan_context.jenkins
   ```

3. **Test your tool** by running the server and using an MCP client

## üîß Troubleshooting

### Common Issues

1. **Database Connection Failed**:
   - Verify your PostgreSQL credentials in `.env`
   - Ensure the database server is accessible
   - Check firewall settings

2. **Jenkins Authentication Error**:
   - Verify your Jenkins URL, username, and token
   - Ensure your Jenkins user has appropriate permissions

3. **Google Sheets API Error**:
   - Check your credentials file path
   - Ensure the Google Sheets API is enabled
   - Verify the service account has access to the sheets

4. **Python Version Issues**:
   - Ensure you're using Python 3.11 or higher
   - Check your virtual environment activation


## üìù License

This project is licensed under the MIT License - see the LICENSE file for details.

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## üìû Support

For issues and questions:
- Create an issue in the repository
- Contact the Performance QA team
- Check the troubleshooting section above

---

**Happy Performance Testing! üéØ**
